<!DOCTYPE html>

<head>
    <script src="~/Scripts/angular.js" type="text/javascript"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="container" ng-app="homeModule" ng-controller="homeController" ng-init="initApp()">
    <h2>Home</h2>
    <form class="form" ng-submit="searchBus()">
        <label for="terminal1">Start from</label>
        <select name="terminal1" id="" ng-model="query.start_terminal">
            <option ng-repeat="terminal in terminals" value="{{terminal.Id}}">{{terminal.name}}</option>
        </select>
        <label for="terminal2">End to</label>
        <select name="terminal2" id="" ng-model="query.end_terminal">
            <option ng-repeat="terminal in terminals" value="{{terminal.Id}}">{{terminal.name}}</option>
        </select>
        <label for="arrivalTime">Arrive before</label>
        <input type="number" name="arrivaltime" id="" ng-model="query.arrivalTime" />
        <label for="date">Date</label>
        <input type="date" name="date" id="" ng-model="query.date" />
        <label for="vacancy">vacancy</label>
        <input type="number" name="vacancy" id="" ng-model="query.vacancy" />
        <button type="submit">Search</button>
    </form>
    <h3  >Search results</h3>
    <table class="table table-striped">
        <tr>
            <th>routeName</th>
            <th>remVacancy</th>
            <th>busName</th>
            <th>action</th>
        </tr>
        <tr ng-repeat="result in searchResults">
            <td>{{result.routeName}}</td>
            <td>{{result.remVacancy}}</td>
            <td>{{result.busName}}</td>
            <td>
                <button class="btn btn-primary">Purchase</button>
            </td>
        </tr>
    </table>
</body>

<script>


    let app = angular.module('homeModule', [])
    app.controller('homeController', ($scope, $http) => {
        $scope.terminals = []
        $scope.searchResults = []
        $scope.query = {
            start_terminal: -1,
            end_terminal: -1,
            arrivalTime: 0,
            vacancy: 1
        }
        $scope.getTerminals = () => {
            $http.get('/Terminal/getTerminals')
                .then(({ data }) => {
                    $scope.terminals = (data)
                })
        }

        $scope.searchBus = function () {

            $http.post('/Home/search', JSON.stringify({ ...$scope.query, date: $scope.query.date*1 }))
                .then(({ data}) => {
                    $scope.searchResults=data
                })
        }
         

        $scope.initApp = function () {
            $scope.getTerminals()
        }
    })

</script>
